<!DOCTYPE html>
<html>
<head>
    <title>Upload to Azure v3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.1336.0/aws-sdk.min.js"></script>
</head>
<body>
    <h2>Upload File to Azure</h2>
    <label>Azure Blob SAS URL:</label>
    <input type="text" id="SasURL" placeholder="Enter shared access signature" /><br>
    <label>Container:</label>
    <input type="text" id="container" placeholder="Enter Container Name" /><br>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">Upload</button>
    <p id="status"></p>
    
    <script>
        const { BlobServiceClient } = require("@azure/storage-blob");
        async function listBlobsFlat() {

            const maxPageSize = 2;

            // Some options for filtering results
            const listOptions = {
                includeMetadata: true,
                includeSnapshots: true,
                prefix: '' // Filter results by blob name prefix
            };

            console.log("Blobs flat list (by page):");
            for await (const response of containerClient
                .listBlobsFlat(listOptions)
                .byPage({ maxPageSize })) {
                console.log("- Page:");
                if (response.segment.blobItems) {
                    for (const blob of response.segment.blobItems) {
                        console.log(`  - ${blob.name}`);
                    }
                }
            }
        }
        async function uploadFile(file) {
            console.log("Upload function called");
            let status = document.getElementById('status');
            status.innerHTML = "Uploading...";
            
            const blobSasUrl = document.getElementById('SasURL').value;
            const containerName = document.getElementById('container').value;
            const fileInput = document.getElementById('fileInput');

            console.log("Checking required fields...")
            if (!blobSasURL || !containerName || !fileInput.files.length) {
                alert("Please fill in all fields and select a file.");
                console.log("Missing input fields");
                return;
            }

            const blobServiceClient = new BlobServiceClient(blobSasUrl);
            const containerClient = blobServiceClient.getContainerClient(containerName);

            const file = fileInput.files[0];
            console.log("File selected: ", file.name)

            const blockBlobClient = containerClient.getBlockBlobClient(file.name);
            console.log("Starting file upload...");
            await blockBlobClient.uploadBrowserData(file, { blockSize: 4 * 1024 * 1024, concurrency: 20 }); // Adjust parameters as needed
            console.log("Finish file upload...");
        }
    </script>
</body>
</html>
